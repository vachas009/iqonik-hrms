<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Self Service - IQONIK HRMS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
  <h1>Employee Self Service (ESS)</h1>

  <!-- Apply for Leave -->
  <div class="card mt-4">
    <div class="card-header">Apply for Leave</div>
    <div class="card-body">
      <form id="leaveForm">
        <div class="mb-2">
          <label>Leave Type</label>
          <select class="form-control" id="leaveType">
            <option value="1">Casual</option>
            <option value="2">Sick</option>
            <option value="3">Earned</option>
          </select>
        </div>
        <div class="mb-2">
          <label>Start Date</label>
          <input type="date" class="form-control" id="startDate" required>
        </div>
        <div class="mb-2">
          <label>End Date</label>
          <input type="date" class="form-control" id="endDate" required>
        </div>
        <div class="mb-2">
          <label>Reason</label>
          <textarea class="form-control" id="reason"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Apply</button>
      </form>
    </div>
  </div>

  <!-- Leave Balances -->
  <div class="card mt-4">
    <div class="card-header">My Leave Balance</div>
    <div class="card-body">
      <table class="table table-bordered" id="leave-balance">
        <thead>
          <tr>
            <th>Leave Type</th>
            <th>Allocated</th>
            <th>Used</th>
            <th>Remaining</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Attendance -->
  <div class="card mt-4">
    <div class="card-header">My Attendance</div>
    <div class="card-body">
      <table class="table table-bordered" id="my-attendance">
        <thead>
          <tr>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
  const token = localStorage.getItem("token") || "";

  // Apply leave
  document.getElementById("leaveForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const body = {
      leave_type_id: document.getElementById("leaveType").value,
      start_date: document.getElementById("startDate").value,
      end_date: document.getElementById("endDate").value,
      reason: document.getElementById("reason").value
    };
    fetch("/api/leave/apply", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify(body)
    })
    .then(res => res.json())
    .then(data => alert(data.message || "Leave applied successfully"));
  });

  // Load leave balance
  function loadLeaveBalance() {
    fetch("/api/leave/balance", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
      let tbody = document.querySelector("#leave-balance tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        tbody.innerHTML += `<tr>
          <td>${row.name}</td>
          <td>${row.allocated}</td>
          <td>${row.used}</td>
          <td>${row.allocated - row.used}</td>
        </tr>`;
      });
    });
  }

  // Load attendance
  function loadAttendance() {
    fetch("/api/attendance/my", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
      let tbody = document.querySelector("#my-attendance tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        tbody.innerHTML += `<tr>
          <td>${row.date}</td>
          <td>${row.status}</td>
        </tr>`;
      });
    });
  }

  loadLeaveBalance();
  loadAttendance();
  </script>
</body>
</html>
