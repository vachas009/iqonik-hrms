<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manager Dashboard - IQONIK HRMS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
  <h1>Manager Dashboard</h1>

  <!-- Pending Leave Requests -->
  <div class="card mt-4">
    <div class="card-header">Pending Leave Requests</div>
    <div class="card-body">
      <table class="table table-bordered" id="pending-leaves">
        <thead>
          <tr>
            <th>Employee</th>
            <th>Leave Type</th>
            <th>Period</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Team Attendance -->
  <div class="card mt-4">
    <div class="card-header">Team Attendance</div>
    <div class="card-body">
      <table class="table table-bordered" id="team-attendance">
        <thead>
          <tr>
            <th>Employee</th>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
  const token = localStorage.getItem("jwt") || "";

  function loadPendingLeaves() {
    fetch("/api/leave/pending", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
      let tbody = document.querySelector("#pending-leaves tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        tbody.innerHTML += `<tr>
          <td>${row.employee_name}</td>
          <td>${row.leave_type_name}</td>
          <td>${row.start_date} â†’ ${row.end_date}</td>
          <td>${row.reason}</td>
          <td>${row.status}</td>
          <td>
            <button class="btn btn-success btn-sm" onclick="updateLeave('${row.id}','APPROVED')">Approve</button>
            <button class="btn btn-danger btn-sm" onclick="updateLeave('${row.id}','REJECTED')">Reject</button>
          </td>
        </tr>`;
      });
    });
  }

  function updateLeave(leaveId, status) {
    fetch(`/api/leave/${leaveId}/status`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ status })
    })
    .then(res => res.json())
    .then(data => {
      alert(data.message || "Status updated");
      loadPendingLeaves();
    });
  }

  function loadTeamAttendance() {
    fetch("/api/attendance/team", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
      let tbody = document.querySelector("#team-attendance tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        tbody.innerHTML += `<tr>
          <td>${row.employee_name}</td>
          <td>${row.date}</td>
          <td>${row.status}</td>
        </tr>`;
      });
    });
  }

  loadPendingLeaves();
  loadTeamAttendance();
  </script>
</body>
</html>
